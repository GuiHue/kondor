o<m11> sub

; Move tool carousel CCW Parameter P number of steps
; Without parameter one step CCW.
; Parameter #5170 is used to track the current tool pocket (persistently)
(print, o<M11> P#<p>)

O100 if [#5171 NE 1]
    (print, atc not homed, homing)
    M13
O100 endif

O110 if [EXISTS[#<p>]]
   #<Steps_to_move> = #<p>
O110 else
   #<Steps_to_move>=1
    (tells the atc widget move 1 step reverse)
O110 endif

(tells the atc widget how many steps to move and start moving reverse)
(DEBUG, EVAL[vcp.getWidget{"dynatc"}.rotate{#<Steps_to_move>, "cw"}])

(tells the atc widget how many steps to move and start moving reverse)
;M64 P4 ; Move atc motor Rev


#<_my_current_pocket> = #5170

o<m11> endsub [1]

M2
